# 🚀 垂直领域大模型与知识图谱融合智能问答系统 (LLM-KG-QA)

> **核心驱动：** 深度融合 Large Language Model (LLM) 的语义理解能力与 Knowledge Graph (KG) 的精确事实知识，打造高可信、可溯源的垂直领域智能助手。

## 📖 项目简介

本项目是一个面向垂直领域的智能问答系统。针对传统 RAG（检索增强生成）在处理复杂实体关系和多跳推理时的局限性，和基于知识图谱的问答系统在实体链接和多跳推理时的局限性，本系统提出了一种创新的 **"预测-链接-推理"** 架构。

系统不仅在算法层面实现了**高精度的实体链接**和**动态图谱路径建模**，在工程层面也构建了包含**知识库自动化构建、多模态文件解析、可视化图谱交互**的一站式前端平台。

### 👉项目特色
当前项目内知识库为面向配电网故障维修领域知识。实际落地应用，可根据需要更改其它领域知识或扩展知识库。

---

## ✨ 核心创新点 (Core Innovations)

### 1. 双重约束下的高精度实体链接 (Dual-Constraint Entity Linking)
传统的实体链接往往依赖单纯的向量相似度。本系统采用 **"类型过滤 + 语义判别"** 的两阶段策略：
- **类型预测：** 对于用户问题，大模型首先预测实体及其可能的两种最优类型，在图谱中大幅缩小候选范围。
- **语义评分：** 引入多线程并行机制，将预测实体与候选实体打包（1 vs 5），让大模型进行深层语义比对并输出链接系数（0~1）。
- **结果择优：** 最终保留系数最高的 Top-2 实体，确保进入推理阶段的锚点准确无误。

### 2. 深度与广度兼顾的动态子图构建 (Dynamic Subgraph Modeling)
摒弃死板的固定跳数检索，采用**问题驱动的动态路径规划**：
- **自适应剪枝：** 在每一跳中，大模型结合用户问题，智能筛选对回答“最有帮助”的三元组，剔除无关噪声。
- **智能终止：** 系统根据当前检索到的信息量，动态判断是否需要继续向下检索实现了深度（多跳推理）与广度（全面覆盖）的完美平衡。
- **未来优化方向：** 由于当前大模型在长链路推理上的局限性，我们这里设置了最多三跳，在未来工作中，尝试解决这一问题。使更多跳数的检索效果更佳。

### 3. 一致性感知的文件知识管理
解决了知识库管理中的“数据孤岛”与“误删”难题。后端优化了文件系统逻辑（引用计数/冲突检测机制），确保当不同文件包含相同三元组时，删除其中一个文件**不会**导致共有知识丢失，保障了图谱数据的完整性。

---

## 🛠️ 系统架构与处理流程

<!-- ![系统架构图](images\jiagou.jpg) -->
<p align="center">
  <img src="images\jiagou.jpg" width="450">
  <br>
  图 1. 系统架构图
</p>
> 系统核心处理链路，从用户提问到最终答案生成的全过程，以及文件管理和用户管理。

### 1️⃣ 实体预测与类型推断
用户提问后，LLM 分析问题，预测涉及的实体及其在图谱中对应的 Top-2 潜在类型。

### 2️⃣ 候选检索与链接判别
- 根据预测类型从 KG 中检索候选实体。
- **多线程并发**调用 LLM，计算预测实体与候选实体的链接系数。
- 筛选出高置信度的真实实体作为图谱检索的起点。

### 3️⃣ 关系路径建模（子图构建）
- **起点：** 真实实体。
- **过程：** 获取实体的一跳三元组 -> LLM 结合问题筛选有效三元组 -> LLM 判断是否继续“下一跳”。
- **结果：** 构建出一个包含推理路径的精简子图。

### 4️⃣ 答案生成
- **有知识命中：** 基于检索到的三元组路径回答问题，提供精准事实。
- **无知识命中：** 自动降级，利用 LLM 预训练知识回答，并明确标注“基于通用知识回答”。

---

## 💻 功能特性与界面展示（产品级交互）

系统基于 Flask 构建，提供了极具人性化的交互界面。

### 🖥️ 1. 智能问答交互区
右侧为主要交互问答窗口。
- **上下文问答：** 开关控制，支持多轮对话记忆。
- **联网搜索增强：** 开关控制，当图谱知识不足时可调用外部搜索引擎。
- **多模式回答：** 系统会自动区分是基于“图谱知识”还是“模型知识”作答。

<!-- ![问答界面截图](images\QA.png) -->

<p align="center">
  <img src="images\QA.png" width="450">
  <br>
  图 2. 问答界面截图
</p>

### 📂 2. 知识库与文件管理
位于左侧功能区，支持非结构化数据到结构化图谱的自动转化。
- **多格式支持：** 支持上传 `.txt`, `.pdf`, `.docx` 文件。
- **自动抽取：** 上传即解析，自动抽取三元组存入图谱。
- **安全删除：** 文件删除后，图谱中对应且无冲突的知识点自动清除。

<!-- ![文件上传管理截图](images\file.png) -->

<p align="center">
  <img src="images\file.png" width="450">
  <br>
  图 3. 文件上传管理截图
</p>

### 🕸️ 3. 知识图谱可视化
点击功能区的“知识图谱”按钮，跳转至可视化大屏。
- 展示当前领域内的实体与关系网络。
- 帮助管理员直观理解知识分布。

<!-- ![知识图谱可视化截图](images\KG.png) -->

<p align="center">
  <img src="images\KG.png" width="450">
  <br>
  图 4. 故障定位流程图
</p>

### ⚙️ 4. 历史记录与用户管理
- **会话管理：** 左侧栏顶部支持新增、删除历史问答记录。
- **用户系统：** 基于本地 JSON 的轻量化注册/登录系统，数据隔离。

---

## 🚀 快速开始 (Quick Start)

### 环境依赖
```bash
pip install -r requirements.txt
```
### 启动项目 
1、 由于github大文件限制，请自行下载neo4j数据库文件并解压至kgqa_project\neo4j\neo4j-community-5.26.0

2、 在kgqa_project\config.py文件中，配置neo4j数据库连接信息和大模型 API 密钥

3、 启动neo4j数据库
```bash
# kgqa_project\neo4j\neo4j-community-5.26.0\bin
neo4j.bat console
```

4、 导入知识图谱到neo4j数据库
```bash
#运行neo4j\import_spo.py文件
python import_spo.py
```

5、 启动项目
```bash
python app.py
```

访问 http://localhost:5000 即可开始使用。

## 📝 未来展望 

1️⃣ 引入向量数据库进行混合检索。

2️⃣ 优化图谱可视化的交互体验（支持点击节点查询）。

3️⃣ 支持更多格式的文件解析（如 Excel, Markdown）。

4️⃣ 针对目前大模型的长链路推理能力弱的问题，尝试解决多跳推理的深度问题。
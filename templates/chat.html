<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>KGQA 智能助手</title>
    <!-- 引入字体和图标库 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Logo / Brand (可选) -->
        <div style="padding:0 10px 20px 10px; font-weight:700; font-size:18px; color:#333;">KGQA Assistant</div>

        <div class="new-chat-btn" onclick="startNewChat()">
            <i class="fas fa-plus"></i> 新建对话
        </div>
        
        <div class="history-list" id="historyList"></div>
        <!-- 新增：文件管理区 (放在功能区上方) -->
        <div class="file-zone">
            <div class="zone-title">
                <span>知识库文件</span>
                <i class="fas fa-cloud-upload-alt" onclick="triggerUpload()" style="cursor:pointer; font-size:14px;" title="上传文件"></i>
                <input type="file" id="fileInput" style="display:none" onchange="handleFileUpload(this)">
            </div>
            
            <!-- 文件列表容器 -->
            <div class="file-list" id="fileList">
                <!-- JS 渲染 -->
            </div>
            
            <!-- 拖拽上传遮罩 (可选，这里简化为点击上传) -->
        </div>
        <!-- 新增：左下角功能区 (在 user-info 上方) -->
        <div class="function-zone">
            <div class="zone-title">功能设置</div>
            
            <!-- 连续对话开关 -->
            <div class="func-item">
                <i class="fas fa-history" style="color:#6b7280; width:20px;"></i>
                <span>连续对话</span>
                <label class="switch-mini">
                    <input type="checkbox" id="contextSwitch" checked>
                    <span class="slider-mini"></span>
                </label>
            </div>

            <!-- 联网搜索开关 -->
            <div class="func-item">
                <i class="fas fa-globe" style="color:#6b7280; width:20px;"></i>
                <span>联网搜索</span>
                <label class="switch-mini">
                    <input type="checkbox" id="webSwitch">
                    <span class="slider-mini"></span>
                </label>
            </div>

            <!-- 图谱跳转按钮 -->
            <a href="/graph" class="graph-link-btn">
                <i class="fas fa-project-diagram"></i> 查看知识图谱
            </a>
        </div>

        <div class="user-info">
            <!-- ... 保持不变 ... -->
            <div style="display:flex; align-items:center; gap:8px;">
                 <div style="width:24px; height:24px; background:#ddd; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:12px;">
                    {{ username[0].upper() }}
                </div>
                {{ username }}
            </div>
            <a href="/logout"><i class="fas fa-sign-out-alt"></i></a>
        </div>
    </div>

    <!-- Main Chat Area -->
    <div class="main-content">
        <div class="chat-container" id="chatContainer">
            <!-- 欢迎消息 -->
            <div class="message bot">
                <div class="avatar"><i class="fas fa-robot"></i></div>
                <div class="text">
                    <strong>你好！我是配电室故障智能助手。</strong><br>
                    我可以帮你查询设备故障、处理措施或知识图谱中的关联信息。<br>
                    <span style="font-size:12px; color:#888; margin-top:5px; display:block;">请直接在下方输入您的问题...</span>
                </div>
            </div>
        </div>
        
        <div class="input-area">
            <!-- <div class="controls-bar">
                <label class="switch-container" title="开启后将结合历史对话进行回答">
                    <input type="checkbox" id="contextSwitch" checked>
                    <span class="slider"></span>
                    <span class="label-text">连续对话模式</span>
                </label>
            </div> -->

            <div class="input-box">
                <textarea id="userJsonInput" placeholder="请输入关于设备故障的问题..." rows="1"></textarea>
                <button onclick="sendMessage()" title="发送"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
    <script>
        // 简单的自动增高 textarea
        const tx = document.getElementById('userJsonInput');
        tx.setAttribute("style", "height:" + (tx.scrollHeight) + "px;overflow-y:hidden;");
        tx.addEventListener("input", OnInput, false);

        function OnInput() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + "px";
        }
    </script>
</body>
</html>